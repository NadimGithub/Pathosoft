{% extends 'base.html' %} {% load static %} {% block title %}Add New Ledger Entry{% endblock %} {% block content %}

<link rel="stylesheet" href="{% static 'css/form-style.css' %}">
<link rel="stylesheet" href="{% static 'css/dropdown.css' %}">
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@1.6.2/dist/select2-bootstrap4.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<div class="container-fluid my-5 d-flex justify-content-center">
    <div class="card lab-card shadow-lg border-0 rounded-4 w-90">
        <div class="card-header d-flex align-items-center justify-content-between rounded-top-4">
            <h4 class="mb-0 text-white">
                <i class="fa-solid fa-book me-2"></i> Add New Ledger Entry
            </h4>
            <a href="{% url 'view_ledger' %}" class="btn btn-light btn-sm fw-semibold rounded-pill px-3 hover-glow">
                <i class="fa-solid fa-arrow-left me-1"></i> Back
            </a>
        </div>
        <div class="card-body p-4">
            <form method="post" class="row g-4" id="ledgerForm">
                {% csrf_token %}
                <div class="col-md-6">
                    <label for="id_lab" class="form-label fw-semibold">Lab</label>
                    <select id="id_lab" name="lab" class="form-select shadow-sm">
        <option value="">-- Select Lab --</option>
        {% for lab in labs %}
        <option value="{{ lab.id }}">{{ lab.lab_name }}</option>
        {% endfor %}
      </select>
                </div>

                <div class="col-md-6">
                    <label for="party_type" class="form-label fw-semibold">Party Type</label>
                    <select id="party_type" name="party_type" class="form-select shadow-sm" required>
        <option value="">-- Select Type --</option>
        <option value="patient">Patient</option>
        <option value="doctor">Doctor</option>
      </select>
                </div>

                <div class="col-md-6">
                    <label for="id_patient" class="form-label fw-semibold">Patient</label>
                    <select id="id_patient" name="patient" class="form-select shadow-sm">
        <option value="">-- Select Patient --</option>
        {% for p in patients %}
        <option value="{{ p.id }}">{{ p.patient_name }}</option>
        {% endfor %}
      </select>
                </div>

                <div class="col-md-6">
                    <label for="id_doctor" class="form-label fw-semibold">Doctor</label>
                    <select id="id_doctor" name="doctor" class="form-select shadow-sm">
        <option value="">-- Select Doctor --</option>
        {% for d in doctors %}
        <option value="{{ d.id }}">{{ d.name }}</option>
        {% endfor %}
      </select>
                </div>

                <div class="col-md-6">
                    <label for="transaction_type" class="form-label fw-semibold">Transaction Type</label>
                    <select id="transaction_type" name="transaction_type" class="form-select shadow-sm" required>
        <option value="">-- Select --</option>
        <option value="credit">Credit</option>
        <option value="debit">Debit</option>
      </select>
                </div>

                <div class="col-md-6">
                    <label for="amount" class="form-label fw-semibold">Amount</label>
                    <input type="number" step="0.01" id="amount" name="amount" class="form-control shadow-sm" placeholder="0.00" required>
                </div>

                <div class="col-md-6">
                    <label for="description" class="form-label fw-semibold">Description</label>
                    <input type="text" id="description" name="description" class="form-control shadow-sm" placeholder="Optional description">
                </div>

                <div class="col-md-6">
                    <label for="date" class="form-label fw-semibold">Date</label>
                    <input type="date" id="date" name="date" class="form-control shadow-sm" required>
                </div>

                <div class="col-md-6">
                    <label for="balance_after" class="form-label fw-semibold">Balance After</label>
                    <input type="number" step="0.01" id="balance_after" name="balance_after" class="form-control shadow-sm" placeholder="0.00" required>
                </div>

                <div class="col-12 text-center mt-4">
                    <button type="submit" class="btn btn-primary px-5 py-2 rounded-pill fw-semibold submit-btn">
        <i class="bi bi-save me-2"></i> Save Entry
      </button>
                </div>
            </form>
        </div>

    </div>
</div>

<script>
    $(document).ready(function() {
        function initSelect2(selector, placeholder) {
            $(selector).select2({
                theme: "bootstrap4",
                placeholder: placeholder,
                allowClear: true,
                width: "100%"
            }).on("select2:open", function() {
                $(".select2-results__options").hide();
                $(".select2-search__field").off("input").on("input", function() {
                    let s = $(this).val().trim();
                    if (s.length > 4) $(".select2-results__options").show();
                    else $(".select2-results__options").hide();
                });
            });
        }

        initSelect2("#id_lab", "Search and select Lab");
        initSelect2("#id_patient", "Search and select Patient");
        initSelect2("#id_doctor", "Search and select Doctor");

        $("#party_type").on("change", function() {
            const val = $(this).val();
            if (val === "patient") {
                $("#id_patient").closest(".col-md-6").show();
                $("#id_doctor").closest(".col-md-6").hide();
            } else if (val === "doctor") {
                $("#id_doctor").closest(".col-md-6").show();
                $("#id_patient").closest(".col-md-6").hide();
            } else {
                $("#id_patient, #id_doctor").closest(".col-md-6").hide();
            }
        }).trigger("change");
    });
</script>

{% endblock %}